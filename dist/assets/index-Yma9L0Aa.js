var l=Object.defineProperty;var g=(t,e,r)=>e in t?l(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var c=(t,e,r)=>g(t,typeof e!="symbol"?e+"":e,r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();const h=1n;function w(t){return t/h}function p(t){return(t==null?void 0:t.command)==="ADD_TO_BUFFER"}function b(){return{command:"BUFFER_FULL"}}function y(){return{command:"BUFFER_LOW"}}function F({lineLayerImageData:t,animationLayerImageData:e,width:r,height:i}){return{command:"INITIALIZE",lineLayerImageData:t,animationLayerImageData:e,width:r,height:i}}const I=100,u=200;class B{constructor(){c(this,"buffering",!0);c(this,"buffer",[]);c(this,"worker");this.worker=new Worker(new URL("/assets/worker-BdPg2q24.js",import.meta.url),{type:"module"})}init({lineLayerImageData:e,animationLayerImageData:r,width:i,height:n}){this.worker.postMessage(F({lineLayerImageData:e,animationLayerImageData:r,width:i,height:n})),this.worker.addEventListener("message",o=>{const s=o==null?void 0:o.data;p(s)&&(this.buffer.push({frame:s.frame,frameNumber:s.frameNumber}),this.buffer.length>u&&this.buffering&&(this.worker.postMessage(b()),this.buffering=!1))})}async fillBuffer(){if(!(this.buffer.length>=u)){if(!this.buffering)throw new Error("Buffer not full but not buffering");return new Promise(async e=>{for(;this.buffer.length<u;)await new Promise(r=>setTimeout(r,100));e()})}}getFrame(){if(this.buffer.length===0)return null;const{frame:e,frameNumber:r}=this.buffer.shift();return this.buffer.length<I&&!this.buffering&&(this.worker.postMessage(y()),this.buffering=!0),{frame:e,frameNumber:r}}}const a=2e3,f=1172;window.addEventListener("DOMContentLoaded",async()=>{const t=document.getElementById("processing-canvas");t.width=a,t.height=f;const e=t.getContext("2d");await m(e,"line-source");const r=document.getElementById("canvas");r.width=a,r.height=f,r.style.transform=`scale(${L()})`;const i=r.getContext("2d");await m(i,"bg-image");const n=new B;for(n.init({lineLayerImageData:e.getImageData(0,0,a,f),animationLayerImageData:i.getImageData(0,0,a,f),width:a,height:f}),await n.fillBuffer();;){const{frame:o,frameNumber:s}=n.getFrame()??{frame:null,frameNumber:null};o&&(i.putImageData(o,0,0),document.getElementById("clock").innerHTML=E(s)),await new Promise(d=>requestAnimationFrame(d))}});function L(){const t=Math.min(window.innerWidth/a,1),e=Math.min(window.innerHeight/f,1);return Math.min(t,e)}function E(t){const e=w(t),r=e/60n,i=r/60n,n=i.toString().padStart(2,"0"),o=(r-i*60n).toString().padStart(2,"0"),s=(e-r*60n).toString().padStart(2,"0");return`${n}:${o}:${s}`}async function m(t,e){const r=await S(e);t.drawImage(r,0,0,a,f),r.remove()}async function S(t){return new Promise((e,r)=>{const i=document.getElementById(t);i.complete?e(i):(i.onload=()=>e(i),i.onerror=()=>{console.error(`Failed to load image with id ${t}`),r()})})}
